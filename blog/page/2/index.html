
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Linux geek's scratchpad</title>
  <meta name="author" content="">

  
  <meta name="description" content="Table of contents Introduction
Setup tftpd
QEMU networking
Verify all components of Virtual Development Platform
What next ? Introduction This was &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pietrushnic.github.io/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Linux geek's scratchpad" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

<!-- Add fancyBox -->
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39420295-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


<!-- AddThis Smart Layers BEGIN -->
<!-- Go to http://www.addthis.com/get/smart-layers to customize -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-534acd39445ac552"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'gray',
    'share' : {
      'position' : 'left',
      'numPreferredServices' : 5
    }, 
    'follow' : {
      'services' : [
        {'service': 'facebook', 'id': 'piotr.krol.756859'},
        {'service': 'twitter', 'id': 'pietrushnic'},
        {'service': 'linkedin', 'id': 'krolpiotr'},
        {'service': 'google_follow', 'id': '115979497998056410813'}
      ]
    },  
    'whatsnext' : {},  
    'recommended' : {} 
  });
</script>
<!-- AddThis Smart Layers END -->
</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Linux geek's scratchpad</a></h1>
  
    <h2>or embedded dreams about productivity, freedom and liberty</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pietrushnic.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/">0x5: Qemu network configuration and tftp for Virtual Development Board</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T10:36:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#intro">Introduction</a></li>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#setup-tftpd">Setup tftpd</a></li>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#qemu-networking">QEMU networking</a></li>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#verify-qemu-with-tftp">Verify all components of Virtual Development Platform</a></li>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#what-next">What next ?</a></li>
</ul>


<p><a id="intro"></a></p>

<h3>Introduction</h3>

<p>This was not trivial task to me. As usual <code>google is your friend</code> and <code>RTFM</code> works.
First we will set tftp which we use to download modified kernel for U-Boot.
Second I will show how to setup bridged network for QEMU needs and finally we
will perform some basic test of our setup. Let&rsquo;s go.</p>

<p><a id="setup-tftpd"></a></p>

<h3>Setup tftpd</h3>

<p>First install:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install tftpd tftp
</span></code></pre></td></tr></table></div></figure>


<p>Make sure that <code>/srv/tftp</code> is writable for your user. If directory doesn&rsquo;t exist
create it and give needed privileges. If you want to change some server options
edit <code>/etc/inetd.conf</code>. Copy or link our kernel to tftp server
directory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /path/to/kernel/arch/arm/boot
</span><span class='line'>ln -s <span class="nv">$PWD</span>/uImage /srv/tftp/uImage
</span></code></pre></td></tr></table></div></figure>


<p>Verify if everything works correctly:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span>             <span class="c"># go to home or any other directory different than arch/arm/boot</span>
</span><span class='line'>tftp 127.0.0.1 <span class="c"># connect to localhost tftp server</span>
</span><span class='line'>get uImage     <span class="c"># get kernel file</span>
</span><span class='line'>q              <span class="c"># quit tftp</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check if kernel file is in current directory. If yes than you tftp server is
configured correctly, if not then google or ask me a question in comments
section.
<em>Note</em>: For Ubuntu follow instructions from
<a href="http://www.davidsudjiman.info/2006/03/27/installing-and-setting-tftpd-in-ubuntu/">here</a>.</p>

<p><a id="qemu-networking"></a></p>

<h3>QEMU networking</h3>

<p><em>Update</em>: For Ubuntu users please read <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#ubuntu-issues">this section</a></p>

<p>I mixed <a href="http://toast.djw.org.uk/qemu.html">this</a> BKM and few other resources
that I found in the net. Setting up network depend a lot on your configuration.
I will briefly describe my situation. It is quite possible that this won&rsquo;t fit
yours.</p>

<p>I&rsquo;ve <code>eth0</code> with ip <code>10.0.2.15</code>. What I want to do is create another interface <code>tap0</code> and
bridge <code>br0</code> that will connect <code>eth0</code> and <code>tap0</code>. To do this I need few things:</p>

<ul>
<li><code>brctl</code> is provided in Debian by <code>bridge-utils</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install bridge-utils
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>check if TUN module was installed</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grep <span class="nv">CONFIG_TUN</span><span class="o">=</span> /boot/config-<span class="sb">`</span>uname -r<span class="sb">`</span>
</span></code></pre></td></tr></table></div></figure>


<p>you should get <code>y</code> or <code>m</code>, if it is <code>m</code> than <code>modprobe tun</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo modprobe tun
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>create tun device</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mknod /dev/net/tun c 10 200
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>update <code>/etc/network/interfaces</code>:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># This file describes the network interfaces available on your system</span>
</span><span class='line'><span class="c"># and how to activate them. For more information, see interfaces(5).</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The loopback network interface</span>
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'><span class="c"># add br0 configuration</span>
</span><span class='line'>auto br0
</span><span class='line'>iface br0 inet dhcp
</span><span class='line'>bridge_ports eth0 <span class="c"># do not forget to attach eth0 to br0</span>
</span><span class='line'>bridge_fd 9
</span><span class='line'>bridge_hello 2
</span><span class='line'>bridge_maxage 12
</span><span class='line'>bridge_stp off
</span><span class='line'>
</span><span class='line'><span class="c"># The primary network interface</span>
</span><span class='line'>allow-hotplug eth0     <span class="c"># comment this</span>
</span><span class='line'>iface eth0 inet dhcp   <span class="c"># and this</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>use <code>/etc/qemu-ifup</code> script to bring up your network:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Executing /etc/qemu-ifup&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Bringing up $1 for bridged mode...&quot;</span>
</span><span class='line'>sudo /sbin/ifconfig <span class="nv">$1</span> 0.0.0.0 promisc up
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Adding $1 to br0...&quot;</span>
</span><span class='line'>sudo /sbin/brctl addif br0 <span class="nv">$1</span>
</span><span class='line'>sleep 2
</span></code></pre></td></tr></table></div></figure>


<p>Give executable permissions for this file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo chmod +x /etc/qemu-ifup
</span></code></pre></td></tr></table></div></figure>


<p>Restart networking services locally:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo service networking restart
</span></code></pre></td></tr></table></div></figure>


<p>This should prepare you environment for tftp booting in qemu.</p>

<p><a id="ubuntu-issues"></a></p>

<h4>Ubuntu issues</h4>

<p>I had experienced few problems with my Ubuntu 12.04.</p>

<ul>
<li><p>First thing was defect that cause looping u-boot during emulation in
qemu-system-arm. I checked latest qemu and version delivered in distro
repository but qemu wasn&rsquo;t issue. I tried debug problem with gdb and qemu
<code>-s -S</code> switches and find out that u-boot crashes at <code>__udivsi3</code> instruction
in <code>serial_init</code>. I tried to google this issue but found only one comment
about this on <a href="http://balau82.wordpress.com/2010/04/12/booting-linux-with-u-boot-on-qemu-arm/">Balau blog</a>:
<blockquote><p>For anyone trying to reproduce this, at least on a recent Ubuntu host, you may need to pass “-cpu all” or “-cpu cortex-a8″ to qemu. The libgcc that gets linked to u-boot appears to be compiled with thumb2 instructions which are not implemented in the Versatile cpu. I don’t get any u-boot console output without this flag, and using gdb I can see that the cpu takes an exception during <code>__udivsi3()</code> called from serial_init().</p><footer><strong>[Grant Likely]</strong></footer></blockquote>
Problem is at least 2-years old and still occurs. Unfortunately Grant&rsquo;s tricks
didn&rsquo;t help. I move to toolchain built by my own and problem was fixed. So the
moral of the story is: DO NOT USE TOOLCHAIN PROVIDED BY UBUNTU at least in
12.04.</p></li>
<li><p>Second thing also involve a lot of debugging time and when I found workaround
it was accidentally. I saw that using procedure correct for Debian on Ubuntu I
was unable to obtain any packet inside U-Boot. Network traffic analysis show
that U-Boot correctly send DHCP discovery and server reply with DHCP offer,
but bootloader behaves like no packet was received.  Static configuration also
didn&rsquo;t work. Finally I get to information how to capture traffic from inside
of emulated setup (parameter <code>-net dump,file=/path/to/file.pcap</code> do the
thing). Surprisingly for some reason adding dump param fix problem and U-Boot
received DHCP Offer and ACK. I will try to narrow down this problem for
further reading please take a look <a href="http://lists.nongnu.org/archive/html/qemu-discuss/2013-05/msg00013.html">qemu</a>
and <a href="">u-boot</a> mailing list thread.</p></li>
</ul>


<p><a id="verify-qemu-with-tftp"></a></p>

<h4>Verify all components of Virtual Development Platform</h4>

<p>So right now we should have built <a href="/blog/2013/06/07/linux-kernel-for-embedded-system">kernel uImage</a>, <a href="/blog/2013/06/07/embedded-board-bootloader">U-Boot image</a>,
<a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#qemu-networking">configured qemu network</a> and <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#setup-tftpd">tftp server</a>. With all this components we can
verify if our kernel booting on emulated <code>versatilepb</code>.</p>

<p>Run your qemu with network using U-Boot image as a kernel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo qemu-system-arm -kernel /path/to/u-boot/u-boot -net nic,vlan<span class="o">=</span>0 -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0,script<span class="o">=</span>/etc/qemu-ifup -nographic -M versatilepb
</span></code></pre></td></tr></table></div></figure>


<p><em>NOTE</em>: We want to use u-boot file instead of u-boot.bin. First is ELF binary
image and second is raw binary. Raw binary image can be used with <code>-bios</code>
parameter for qemu. If you try to give raw binary as a kernel parameter it will result with error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>qemu: fatal: Trying to execute code outside RAM or ROM at 0x08000000
</span></code></pre></td></tr></table></div></figure>


<p><em>NOTE 2</em>: We have to specify <code>versatilepb</code> machine. If we forget it we will get
error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>qemu: hardware error: integratorcm_read: Unimplemented offset 0x1e0000
</span></code></pre></td></tr></table></div></figure>


<p>Right now we have u-boot booted. Let&rsquo;s set ip addresses to boot uImage from our
tftp server. For verification needs we don&rsquo;t want to <code>autoload</code> downloaded
image, so we disable this through environment variable.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>setenv autoload no
</span><span class='line'>dhcp
</span><span class='line'>setenv serverip 192.168.1.2
</span><span class='line'>setenv bootfile uImage
</span><span class='line'>tftpboot
</span></code></pre></td></tr></table></div></figure>


<p>Set addresses according to your configuration. For some reason I was unable to
use u-boot <code>dhcp</code> feature. It assign me address that exist in the network.</p>

<p>We can take a close look on out downloaded image with <code>iminfo</code> command.
<code>tftpboot</code> and <code>iminfo</code> should looks like that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>VersatilePB <span class="c"># tftpboot</span>
</span><span class='line'>SMC91111: PHY auto-negotiate timed out
</span><span class='line'>SMC91111: MAC 52:54:00:12:34:56
</span><span class='line'>Using SMC91111-0 device
</span><span class='line'>TFTP from server 10.0.2.15; our IP address is 10.0.2.16
</span><span class='line'>Filename <span class="s1">&#39;uImage&#39;</span>.
</span><span class='line'>Load address: 0x7fc0
</span><span class='line'>Loading: <span class="c">#################################################################</span>
</span><span class='line'>         <span class="c">#################################################################</span>
</span><span class='line'>         <span class="c">#################################################################</span>
</span><span class='line'>         <span class="c">#################################################################</span>
</span><span class='line'>         <span class="c">#################################################################</span>
</span><span class='line'>         <span class="c">##############################################</span>
</span><span class='line'>         0 Bytes/s
</span><span class='line'><span class="k">done</span>
</span><span class='line'>Bytes <span class="nv">transferred</span> <span class="o">=</span>
</span><span class='line'>1895064 <span class="o">(</span>1cea98 hex<span class="o">)</span>
</span><span class='line'>VersatilePB <span class="c"># iminfo</span>
</span><span class='line'>
</span><span class='line'><span class="c">## Checking Image at </span>
</span><span class='line'>00007fc0 ...
</span><span class='line'>    Legacy image found
</span><span class='line'>    Image Name:   Linux-3.9.0-rc8
</span><span class='line'>    Image Type:   ARM Linux Kernel Image <span class="o">(</span>uncompressed<span class="o">)</span>
</span><span class='line'>    Data Size:    1895000 <span class="nv">Bytes</span> <span class="o">=</span> 1.8 MiB
</span><span class='line'>    Load Address: 00008000
</span><span class='line'>    Entry Point:  00008000
</span><span class='line'>    Verifying Checksum ... OK
</span></code></pre></td></tr></table></div></figure>


<p>So, that what we want to see. Pretty new kernel <code>3.9.0-rc8</code> compiled as ARM
image. We can try to boot it but we will end with kernel panic because lack of
filesystem.</p>

<p><em>NOTE 3</em>: If you want to see anything after booting this image with <code>bootm</code> you
have to pass to kernel additional boot argument with serial device that should
be used as a console. Before <code>bootm</code> set:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>setenv bootargs <span class="nv">console</span><span class="o">=</span>ttyAMA0
</span></code></pre></td></tr></table></div></figure>


<p>You should get something similar to below log:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>...<span class="o">)</span>
</span><span class='line'>eth0: SMC91C11xFD <span class="o">(</span>rev 1<span class="o">)</span> at c89c8000 IRQ 57 <span class="o">[</span>nowait<span class="o">]</span>
</span><span class='line'>eth0: Ethernet addr: 52:54:00:12:34:56
</span><span class='line'>mousedev: PS/2 mouse device common <span class="k">for </span>all mice
</span><span class='line'>TCP: cubic registered
</span><span class='line'>NET: Registered protocol family 17
</span><span class='line'>VFP support v0.3: implementor 41 architecture 1 part 10 variant 9 rev 0
</span><span class='line'>VFS: Cannot open root device <span class="s2">&quot;(null)&quot;</span> or unknown-block<span class="o">(</span>0,0<span class="o">)</span>: error -6
</span><span class='line'>Please append a correct <span class="s2">&quot;root=&quot;</span> boot option; here are the available partitions:
</span><span class='line'>1f00           65536 mtdblock0  <span class="o">(</span>driver?<span class="o">)</span>
</span><span class='line'>Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block<span class="o">(</span>0,0<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c0018afc&gt;<span class="o">]</span> <span class="o">(</span>unwind_backtrace+0x0/0xf0<span class="o">)</span> from <span class="o">[</span>&lt;c027af8c&gt;<span class="o">]</span> <span class="o">(</span>panic+0x80/0x1d0<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c027af8c&gt;<span class="o">]</span> <span class="o">(</span>panic+0x80/0x1d0<span class="o">)</span> from <span class="o">[</span>&lt;c0343c64&gt;<span class="o">]</span> <span class="o">(</span>mount_block_root+0x1a0/0x258<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c0343c64&gt;<span class="o">]</span> <span class="o">(</span>mount_block_root+0x1a0/0x258<span class="o">)</span> from <span class="o">[</span>&lt;c0343f08&gt;<span class="o">]</span> <span class="o">(</span>mount_root+0xf0/0x118<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c0343f08&gt;<span class="o">]</span> <span class="o">(</span>mount_root+0xf0/0x118<span class="o">)</span> from <span class="o">[</span>&lt;c0344090&gt;<span class="o">]</span> <span class="o">(</span>prepare_namespace+0x160/0x1b4<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c0344090&gt;<span class="o">]</span> <span class="o">(</span>prepare_namespace+0x160/0x1b4<span class="o">)</span> from <span class="o">[</span>&lt;c03438ec&gt;<span class="o">]</span> <span class="o">(</span>kernel_init_freeable+0x168/0x1ac<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c03438ec&gt;<span class="o">]</span> <span class="o">(</span>kernel_init_freeable+0x168/0x1ac<span class="o">)</span> from <span class="o">[</span>&lt;c027a074&gt;<span class="o">]</span> <span class="o">(</span>kernel_init+0x8/0xe4<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;c027a074&gt;<span class="o">]</span> <span class="o">(</span>kernel_init+0x8/0xe4<span class="o">)</span> from <span class="o">[</span>&lt;c0013df0&gt;<span class="o">]</span> <span class="o">(</span>ret_from_fork+0x14/0x24<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is expected result.</p>

<p><a id="what-next"></a></p>

<h3>What next ?</h3>

<p>We happily built basic virtual development, what we need right now is some
<a href="/blog/2013/06/07/root-file-system-for-embedded-system">initial filesystem</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/linux-kernel-for-embedded-system/">0x4: Linux kernel for embedded system</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T10:33:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/linux-kernel-for-embedded-system/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/linux-kernel-for-embedded-system/#a-little-history">A little history</a></li>
<li><a href="/blog/2013/06/07/linux-kernel-for-embedded-system/#get-linux-and-build-it">Get linux and build it</a></li>
<li><a href="/blog/2013/06/07/linux-kernel-for-embedded-system/#kudos">Kudos</a></li>
</ul>


<p><a id="a-little-history"></a></p>

<h3>A little history</h3>

<p>Thinking about embedded linux probably leads to  first try of porting linux to
different architecture. I did google research (I know I should probably read
mailing list archive) and found that there were few attempt to port linux to
different platform. There is no clear information about which port of linux was
first. This is probably because many hackers didn&rsquo;t report their effort. Arguably
earliest out-of-tree version was probably for Acron A5000 (arm), Motorola 68000
(m68k) around Spring/Summer of 1994. I found also notes about SPARC port in
1993. Some sources also tells story about 1993 Amiga and Atari port. But first
port that get in to official linux tree was DEC Alpha.<a href="http://digital-domain.net/lug/unix-linux-history.html">[1]</a><a href="http://www.arm.linux.org.uk/docs/history.php">[2]</a></p>

<p>So linux is already 22 years old and first port start when it was 2-3 years old,
so we can assume it is mature enough to support most of non-x86 architectures.</p>

<p><a id="get-linux-and-build-it"></a></p>

<h3>Get linux and build it</h3>

<p>To deal with our <em>embedded</em> board we need operating system or some kind of
software that will allow us to use board features. Right now to boot system we
need at least kernel. So we have to prepare kernel for board of choice
<code>versatilepb</code>.</p>

<p>Let&rsquo;s start with cloning Linux repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</span></code></pre></td></tr></table></div></figure>


<p>and configure kernel for <code>versatilepb</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd linux
</span><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- versatile_defconfig</span></code></pre></td></tr></table></div></figure>


<p>It looks some feature is disabled in <code>versatile_defconfig</code>. I mean
<code>CONFIG_AEABI</code>. It specifies file format, data types, register usage and other
things. The main difference between EABI and ABI is that privileged instructions
are allowed in application code. More about EABI
<a href="http://en.wikipedia.org/wiki/Application_binary_interface#EABI">here</a>.
To enable this option run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig</span></code></pre></td></tr></table></div></figure>


<p>and go to:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Kernel Features -&gt; Use the ARM EABI to compile the kernel</span></code></pre></td></tr></table></div></figure>


<p>We will also need DHCP and NFS support (CONFIG_IP_PNP_DHCP and CONFIG_ROOT_NFS).
First is <code>IP: DHCP support</code> and can be found under:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-&gt; Networking support (NET [=y])
</span><span class='line'>  -&gt; Networking options
</span><span class='line'>    -&gt; TCP/IP networking (INET [=y])
</span><span class='line'>      -&gt; IP: kernel level autoconfiguration (IP_PNP [=y])</span></code></pre></td></tr></table></div></figure>


<p>Second is :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-&gt; File systems
</span><span class='line'>  -&gt; Network File Systems (NETWORK_FILESYSTEMS [=y])  </span></code></pre></td></tr></table></div></figure>


<p>let&rsquo;s build image with U-Boot support.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- uImage</span></code></pre></td></tr></table></div></figure>


<p>We have kernel. How we can provide this kernel to our development environment ?
As I discuss in <a href="/blog/2013/06/07/embedded-board-bootloader">previous post</a> we
can use bare-metal qemu, but not with uImage kernel. This is special U-Boot
kernel, so easiest way will be using it with bootloader. We will figure out how
to do this in <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board">next section</a>
about tftp and qemu network configuration.</p>

<p><strong>TODO</strong>: add picture of configuration in intro &ndash; vdb, link it here
Target configuration will consist on providing kernel through tftp server using U-Boot. Also
want to use NFS root filesystem to boot our small distro. As it is in real
development environment.</p>

<p><em>NOTE</em>: During compilation process you can encounter error like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(...)
</span><span class='line'>  UIMAGE  arch/arm/boot/uImage
</span><span class='line'>  "mkimage" command not found - U-Boot images will not be built
</span><span class='line'>  make[1]: *** [arch/arm/boot/uImage] Error 1
</span><span class='line'>  make: *** [uImage] Error 2</span></code></pre></td></tr></table></div></figure>


<p>Of course it means that we need mkimage to create U-Boot image, so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install uboot-mkimage</span></code></pre></td></tr></table></div></figure>


<p><em>Update</em>: in Debian jessie/sid this package was replaced by <code>u-boot-tools</code>.</p>

<p>We have to use uImage special build because load and execute address differes
from board to board. If we will use vmlinux image then addresses should be
manually modified. So using uImage is easiest</p>

<p><a id="kudos"></a></p>

<h3>Kudos</h3>

<p>[1] <a href="http://digital-domain.net/lug/unix-linux-history.html">UNIX/Linux History</a></br>
[2] <a href="http://www.arm.linux.org.uk/docs/history.php">The History of ARM Linux</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/embedded-board-bootloader/">0x3: Embedded board bootloader</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T10:32:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/embedded-board-bootloader/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#what-is-bootloader">What is bootloader ?</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#why-we-need-bootloader">Why we need bootloader ?</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#which-bootloader">Which bootloader ?</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#what-is-versatilepb">What is versatilepb ?</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#compilation">Compilation</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#where-to-go-from-here">Where to go from here ?</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/#kudos">Kudos</a></li>
</ul>


<p><a id="what-is-bootloader"></a></p>

<h3>What is bootloader ?</h3>

<p>It is a program written to bring up more complex code (eg. kernel).</p>

<p>On very simple system it can even not exist. Bootloader should prepare all
required hardware that kernel or different operating software will need at its
start point. It is hard to create cross platform bootloader because of variety
of system requirements.</p>

<p><a id="why-we-need-bootloader"></a></p>

<h3>Why we need bootloader ?</h3>

<p>The true is that we don&rsquo;t :) because we can simply pass kernel and initramfs as
parameters to QEMU, but it is not common practice for real development environment.<br/>
Usually bootloader is stripped in production environment where boot time is
crucial. Second thing, bootloader is useful to learn how real development
environment for embedded system works. From other side using bootloader we can
create single binary file that contain bootable embedded system, so we can run
it without giving multiple arguments at QEMU startup. I will try to keep in mind
idea about being as close to real development environment as possible.</p>

<p><a id="which-bootloader"></a></p>

<h3>Which bootloader ?</h3>

<p>There are many approaches to this problem. The most popular today is
<a href="http://www.denx.de/wiki/U-Boot">U-Boot</a> but there are alternatives like <a href="http://www.barebox.org/">The Barebox Bootloader</a>.
I will try to get to know them better in future. Right now I will use U-Boot as
Virtual Development Board bootloader to make the edit-compile-download-test cycle
similar to real world situation. So get the code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone http://git.denx.de/u-boot.git
</span></code></pre></td></tr></table></div></figure>


<p>U-Boot configuration depends on pair cpu-board. So right now we know that our
cpu will be some ARM but what exactly ? It depends on configuration we will use.
In most scenarios presented in Internet the <code>versatilepb</code> was used. We can also
think about running different boards.</p>

<p>What pros U-Boot gives us in the light of previous question <code>Why we need
bootloader ?</code>:
* simplified process of porting kernel, because low level stuff is handled by
U-Boot
* simplified testing environment in easy way you can grab different version of
  kernel with different version of initrd and test it</p>

<p><a id="what-is-versatilepb"></a></p>

<h3>What is versatilepb ?</h3>

<p>According to <a href="http://www.arm.com/products/tools/development-boards/versatile/index.php">this page</a>
versatile is highly modular, feature-rich range of development board. <code>pb</code>
means <code>Platform Baseboard</code> integrated, standalone development system with fixed
CPU. But this is only corporate babble :)</p>

<p>QEMU shows <code>versatilepb</code> as Versatile/PB
(<a href="http://www.arm.com/products/processors/classic/arm9/arm926.php">ARM926EJ-S</a>).</p>

<p><a id="compilation"></a></p>

<h3>Compilation</h3>

<p>For <code>Emdebian</code> cross-toolchain:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>u-boot
</span><span class='line'>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi- versatilepb_config
</span><span class='line'>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-
</span></code></pre></td></tr></table></div></figure>


<p><em>Note</em>: If you wonder what is the convention for cross-toolchain prefix:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>arch<span class="o">]</span>-<span class="o">[</span>vendor<span class="o">]</span>-<span class="o">[</span>os<span class="o">]</span>-<span class="o">[</span>abi<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Emdebian</code> striped vendor probably to keep name short, but for example
<code>Corsstool-NG</code> follow convetion and calls toolchain like
<code>arm-unknown-linux-gnueabi-</code>.</p>

<p><a id="where-to-go-from-here"></a></p>

<h3>Where to go from here ?</h3>

<p><a href="/blog/2013/06/07/linux-kernel-for-embedded-system">Next step</a> will be kernel compilation for our virtual <code>versatilepb</code> board.</p>

<p><a id="kudos"></a></p>

<h3>Kudos</h3>

<p>[1] <a href="http://www.linuxfordevices.com/c/a/Linux-For-Devices-Articles/Introduction-to-Das-UBoot-the-universal-open-source-bootloader/">Introduction to Das U-Boot, the universal open source bootloader</a></br>
[2] <a href="http://www.denx.de/wiki/U-Boot">U-Boot</a></br>
[3] <a href="http://forum.xda-developers.com/showthread.php?t=2201146">U-boot for the multi-boot support</a></br>
[4] <a href="http://balau82.wordpress.com/2010/04/12/booting-linux-with-u-boot-on-qemu-arm/">Booting Linux with U-Boot on QEMU ARM</a></br>
[5] <a href="http://wiki.osdev.org/Bootloader">Bootloader</a></br></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/">0x2: Toolchain for Virtual Development Board</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T08:42:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#intro">Introduction</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#what-is-toolchain">What is toolchain ?</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#why-we-need-cross-toolchain">Why we need cross-toolchain ?</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#how-to-create-toolchain">How to create toolchain ?</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#emdebian-path">Emdebian path</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#summary">Summary</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/#kudos">Kudos</a></li>
</ul>


<p><a id="intro"></a></p>

<h3>Introduction</h3>

<p>This is probably the most complicated topic of all related to embedded
development but we need to deal with it at the beginning. I read a lot about
toolchains but still don&rsquo;t know enough to explain details. I think that best
answers are in crosstool-ng <a href="http://crosstool-ng.org/hg/crosstool-ng/file/0fc56e62cecf/docs">documentation</a>.</p>

<p><a id="what-is-toolchain"></a></p>

<h3>What is toolchain ?</h3>

<p><em>Toolchain</em> as the name said is a set of tools chained together, so output of
one tool is the input for different tool. This is well known concept in
Linux (eg. pipes). In embedded environment toolchain is called cross-toolchain or
cross-compiler, because usually it compiles on one architecture and generate
code for another (eg. it compiles on x86 and generate code for arm)<a href="http://elinux.org/Toolchains">[1]</a>.</p>

<p><a id="why-we-need-cross-toolchain"></a></p>

<h3>Why we need cross-toolchain ?</h3>

<p>I suspect that your laptop/PC is not based on ARM processor, most probably it based on
x86 architecture so you cannot simply compile code and run it in our
virtual-arm-based environment. To prepare operating system and tools for it we
need cross-toolchain.</p>

<p><a id="how-to-create-toolchain"></a></p>

<h3>How to create toolchain ?</h3>

<p>Process of creating cross-toolchain from scratch is not easy and takes some
time. There are few other ways to get toolchain, than creating it from scratch.
First we can use prebuilt toolchain providers like: <code>CodeSourcery</code>, <code>Linaro</code>, <code>DENX
EDLK</code> or <code>Emdebian</code>. Second we can create toolchain using special building system like: <code>Buildroot</code>, <code>Crosstool-NG</code>
or <code>Bitbake</code>. I will not deal with preparing toolchain in this series
because procedure for creating it takes pretty long. So we have two options:</p>

<ul>
<li>read my article about <a href="/blog/2013/04/03/yet-another-quick-build-of-arm-unknown-linux-gnueabi">Crosstool-NG arm-unknown-linux-gnueabi</a></li>
<li>or install toolchain ready to use like <a href="http://www.emdebian.org/">Emdebian</a></li>
</ul>


<p><a id="emdebian-path"></a></p>

<h4>Emdebian path</h4>

<p>Add below lines to you <code>/etc/apt/sources.list</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>deb http://ftp.uk.debian.org/emdebian/toolchains unstable main
</span></code></pre></td></tr></table></div></figure>


<p>Install Emdebian keys, update and install cross-compiler with all related
packages:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install emdebian-archive-keyring
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install gcc-4.7-arm-linux-gnueabi
</span></code></pre></td></tr></table></div></figure>


<h5>Dependency problems during installation</h5>

<p>If above attempt to install cross-compiler ends with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pietrushnic@eglarest:~/src<span class="nv">$ </span>sudo apt-get install gcc-4.7-arm-linux-gnueabi
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree
</span><span class='line'>Reading state information... Done
</span><span class='line'>Some packages could not be installed. This may mean that you have
</span><span class='line'>requested an impossible situation or <span class="k">if </span>you are using the unstable
</span><span class='line'>distribution that some required packages have not yet been created
</span><span class='line'>or been moved out of Incoming.
</span><span class='line'>The following information may <span class="nb">help </span>to resolve the situation:
</span><span class='line'>
</span><span class='line'>The following packages have unmet dependencies:
</span><span class='line'> gcc-4.7-arm-linux-gnueabi : Depends: libgomp1-armel-cross <span class="o">(</span>&gt;<span class="o">=</span> 4.7.2-5<span class="o">)</span> but it
</span><span class='line'> is not going to be installed
</span><span class='line'> E: Unable to correct problems, you have held broken packages.
</span></code></pre></td></tr></table></div></figure>


<p>This means that Debian ustable cross-compiler is not available for you
configuration. You can read more about that
<a href="http://lists.debian.org/debian-embedded/2011/05/msg00029.html">here</a>.
To fix that issue simply change emdebian toochain repository to testing in
<code>/etc/apt/source.list</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>deb http://ftp.uk.debian.org/emdebian/toolchains testing main
</span></code></pre></td></tr></table></div></figure>


<h5>Emdebian toolchain configuration</h5>

<p>Check where <code>arm-linux-eabi-gcc-4.7</code> was installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>whereis arm-linux-gnueabi-gcc-4.7
</span><span class='line'>arm-linux-gnueabi-gcc-4: /usr/bin/arm-linux-gnueabi-gcc-4.7 /usr/bin/X11/arm-linux-gnueabi-gcc-4.7
</span></code></pre></td></tr></table></div></figure>


<p>It is not linked to <code>arm-linux-gnueabi-gcc</code>, so we cannot give its prefix as <code>CROSS_COMPILE</code>
variable value, which is needed for bootloader and kernel compilation. We have to link
it to <code>arm-linux-gnueabi-gcc</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo ln -s /usr/bin/arm-linux-gnueabi-gcc-4.7 /usr/bin/arm-linux-gnueabi-gcc
</span></code></pre></td></tr></table></div></figure>


<p>Toolchain is ready to use.</p>

<p><em>Note</em>: I tried <code>CodeSourcery</code> toolchain <code>arm-2012.09-64-arm-none-linux-gnueabi.bin</code>,
but it contain <code>binutils</code> defect that not allow correctly build kernel. If you see
something like this in log:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Error: selected processor does not support ARM mode <span class="sb">`</span>ldralt lr,<span class="o">[</span>r1<span class="o">]</span>,#4<span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That means you experience same thing, please use <code>Emdebian</code> or <code>Crosstool-NG</code> toolchain.</p>

<p><em>Note 2</em>: If you&rsquo;re <code>Ubuntu</code> user I have to suggest experiments with toolchain
build by your own, because I get really hard times trying to go through this
tutorial with Ubuntu/Linaro cross compiler provided in repository. Finally I
used <a href="/blog/2013/04/03/yet-another-quick-build-of-arm-unknown-linux-gnueabi">this</a>
to push things forward. U-boot compiled with Ubuntu/Linaro toolchain had problem
with <code>__udivsi3</code> instruction. This cause loop in initialization process.</p>

<p><a id="summary"></a></p>

<h3>Summary</h3>

<p>If you take effort of creating toolchain using <code>Crosstool-NG</code> than
congratulations.  But for simplifying whole <a href="/blog/2013/06/07/intro-to-virtual-development-board-building"><strong>Virtual Development Board</strong></a>
series I will use <code>Emdebian</code> toolchain in further posts. Of course you can use
your brand new <code>Crosstool-NG</code> toolchain by simply remember that tools prefixes are
different. <code>Emdebian</code> uses <code>arm-linux-gnueabi-</code> and <code>Crosstool-NG</code> was created with
<code>arm-unknown-linux-gnueabi-</code>. Replace one with another every time when needed.
In <a href="/blog/2013/06/07/embedded-board-bootloader">next post</a> we will deal with
bootloader.</p>

<p><a id="kudos"></a></p>

<h3>Kudos</h3>

<p>[1] <a href="http://elinux.org/Toolchains">Toolchains</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/">0x1: Qemu as an environment for embedded board emulation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T08:27:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/#intro">Introduction</a></li>
<li><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/#compilation">Compilation</a></li>
<li><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/#kudos">Kudos</a></li>
</ul>


<p><a id="intro"></a></p>

<h3>Introduction</h3>

<p>QEMU is a CPU emulator using dynamic binary translation to convert guest CPU
instructions into host CPU instructions<a href="http://infoscience.epfl.ch/record/149975/files/x86-llvm-translator-chipounov_2.pdf">[1]</a>. It supports many architectures from
x86, through ARM and MIPS, to MicroBlaze. According to compilation configuration
target list QEMU targets 26 different softmmu types.  Only for ARM it supports
33 machines (like ARM Versatile/PB (ARM926EJ-S) or Samsung NURI board
(Exynos4210)) and 28 CPUs (with cortex-a9 and pxa270). It gives access to
network, storage, video, usb, serial and other peripheral, also user defined. It
is developed under GNU GPL, so everybody are free to make modifications, improve
and extend it. This properties makes QEMU very good candidate for virtual board
emulator.</p>

<p><a id="compilation"></a></p>

<h3>Compilation</h3>

<p>Let&rsquo;s start creating our Virtual Development Board. As usually I will use latest
greatest version from git:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone http://git.qemu.org/git/qemu.git
</span></code></pre></td></tr></table></div></figure>


<p>Compile it and install. Right now I will use only <code>arm-softmmu</code> target because it
will emulate whole arm system for me. ARM right now dominated big part of
embedded market but we will see if situation won&rsquo;t change in feature.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>qemu
</span><span class='line'>./configure --target-list<span class="o">=</span>arm-softmmu
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>During configuration process you can encounter lack of <code>pixman</code>, just accept qemu
offer to initialize it as a submodule.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git submodule update --init pixman
</span><span class='line'>make <span class="c"># restart compilation process</span>
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>If compilation ends without problem than our first component is ready to use.
Right now we can emulate our ARM based board with many types of CPUs. List of
all available can be retrieved by running command <code>qemu-system-arm -cpu ?</code>, list
of emulated machines by <code>-M ?</code>. Now, let&rsquo;s talk about <a href="/blog/2013/06/07/toolchain-for-virtual-development-board">toolchains</a>.</p>

<p><a id="kudos"></a></p>

<h3>Kudos</h3>

<p>[1] <a href="http://infoscience.epfl.ch/record/149975/files/x86-llvm-translator-chipounov_2.pdf">Dynamically Translating x86 to LLVM using QEMU</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/07/intro-to-virtual-development-board-building/">0x0: Intro to Virtual Development Board building</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-07T01:27:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/07/intro-to-virtual-development-board-building/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="/blog/2013/06/07/intro-to-virtual-development-board-building/#preface">Preface</a></li>
<li><a href="/blog/2013/06/07/intro-to-virtual-development-board-building/#first-question">First question: How to start ?</a></li>
<li><a href="/blog/2013/06/07/intro-to-virtual-development-board-building/#virtual-development-board">Virtual Development Board &ndash; table of contents</a></li>
<li><a href="/blog/2013/06/07/intro-to-virtual-development-board-building/#kudos">Kudos</a></li>
</ul>


<p><a id="preface"></a></p>

<h3>Preface</h3>

<p>There are many reasons why ambitious programmers should care about huge rush in
embedded market. IMO there is great potential in it. I don&rsquo;t want to go deep into
this but take a look at all tablets, phones, smart TVs and other cool stuff
like wireless in you washing machine or refrigerator (ok this two are right now only a gadgets :) ).
This is all embedded. Another thing is that wages of experienced embedded
developers are really high.</p>

<p>This environment is very interesting. A lot to learn, a lot to do, so why not get
your hands dirty ?</p>

<p><a id="first-question"></a></p>

<h3>First question: How to start ?</h3>

<p>To do real embedded development, to learn the most, you simply buy hardware like
all this <code>${animal}board (animal={panda,beagle,hawk})</code>. This is the best way but
if you&rsquo;re beginner (like me) you probably don&rsquo;t want to spend $50 for stuff that
you throw away after month because you don&rsquo;t like to deal with it or problems
are not on your level, than maybe you should take a look around and wonder if it
is possible to build virtual environment to check what kind of problem you may
encounter learning embedded ? BTW this is cheap and fun, so potential ROI is big
enough to try.</p>

<p>IMHO this is where world going: proof of concept embedded platforms affordable
for common man (not only for US/West Europe), testing environment based on
virtualized/emulated solution, to check basic features, speed up testing, development
and deployment. That&rsquo;s why we see so active development of software like Qemu/KVM.</p>

<p><a id="virtual-development-board"></a></p>

<h3>Virtual Development Board &ndash; table of contents</h3>

<p>I realize that it is achievable and I will learn a lot trying to implement this
idea. Finally I was convinced reading <a href="http://www.elinux.org/Virtual_Development_Board">this</a>
two years old article on <a href="http://www.elinux.org">eLinux.org</a>.</p>

<p>I decide to divide this article on few parts because IMHO it was to big to read
it at once. Also people interesting in particular topic won&rsquo;t have to scrolling <code>&gt;2k</code>
words post. List of all articles in this series:</p>

<ol>
<li><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation/">Qemu as an environment for embedded board emulation</a></li>
<li><a href="/blog/2013/06/07/toolchain-for-virtual-development-board/">Toolchain for Virtual Development Board</a></li>
<li><a href="/blog/2013/06/07/embedded-board-bootloader/">Embedded board bootloader</a></li>
<li><a href="/blog/2013/06/07/linux-kernel-for-embedded-system/">Linux kernel for embedded system</a></li>
<li><a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/">Qemu network configuration and tftp for Virtual Development Board</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/">Root file system for embedded system</a></li>
</ol>


<p><a id="kudos"></a></p>

<h3>Kudos</h3>

<p>At the and of this intro I want to give big kudos to all those hackers without
whom creating this article would not be possible. Thanks for sharing your
knowledge. Every time when I use knowledge that found by googling I&rsquo;m trying
to stick link for further reading.</p>

<h4><a href="/blog/2013/06/07/qemu-as-an-environment-for-embedded-board-emulation"><em>Enjoy!</em></a></h4>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/16/octopress-depoying-problem-after-migrating-to-star-dot-github-dot-io/">Octopress depoying problem after migrating to *.github.io</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-16T22:20:00+02:00" pubdate data-updated="true">May 16<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/16/octopress-depoying-problem-after-migrating-to-star-dot-github-dot-io/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My story was that I migrate to new environment and want to recover my octopress
setup. I thought that it will be as simple as cloning my blog github repository
and start to work.</p>

<p>First problem that I experienced was lack of octopress repository as a remote
branch &ndash; it is required to update your ocotpress blog to latest code. Fix was
simple:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git remote add octopress git://github.com/imathis/octopress.git</span></code></pre></td></tr></table></div></figure>


<p>After updating my blog I tried to deploy new article and I get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## Pushing generated _deploy website
</span><span class='line'>ERROR: Repository not found.
</span><span class='line'>fatal: The remote end hung up unexpectedly</span></code></pre></td></tr></table></div></figure>


<p>I figured out that my github pages were incorrectly set, so I run <code>rake
setup_github_pages</code>. If you&rsquo;re user of github pages long enough you know that
few weeks ago github decide to migrate domain from <code>*.github.com</code> to
<code>*.github.io</code>. So I followed instructions in setup process and used <code>io</code> domain,
this is incorrect. If you have github repository for your pages with <code>com</code> in
name you should use your orginal repository address. Repository was not changed.
This is obvious but I lost few minutes to figure out whats going on.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/16/workflow-imporovement-with-open-source-tools/">Workflow imporovement with Open Source tools - part 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-16T22:16:00+02:00" pubdate data-updated="true">May 16<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/16/workflow-imporovement-with-open-source-tools/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Introduction</h3>

<p>I want to start a series of articles to describe how I improve my workflow with
geeky Open Source applications. I will concentrate on terminal applications that
I try to use in my GTD process.</p>

<h3>Terminal</h3>

<h4>Solarized gnome-terminal</h4>

<p>If you already don&rsquo;t know what solarized color scheme is then please take a look
at <a href="http://ethanschoonover.com/solarized">this page</a>. To install solarized
colorscheme in gnome-terminal simply follow instruction from this <a href="https://github.com/sigurdga/gnome-terminal-colors-solarized">git repository</a>.</p>

<h3>Mutt again</h3>

<p>During last days I spent a lot of time to tweak my mutt configuration. Here I
will give you few hints about things that I learned.</p>

<h4>Solarized mutt</h4>

<p>To enable solarized colorscheme in mutt simply download one of scheme files from <a href="https://github.com/altercation/mutt-colors-solarized">github</a>. If you installed
dark scheme for your gnome-terminal then I suggest <code>mutt-colors-solarized-dark-16.muttrc</code>.
Copy this file for example to <code>$HOME/.mutt</code> and source it in muttrc file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source $HOME/.mutt/mutt-colors-solarized-dark-16.muttrc</span></code></pre></td></tr></table></div></figure>


<h4>Width of From column</h4>

<p>Usually from field in today&rsquo;s emails is longer than 19 characters. If this
happens mutt by default will not display whole string. To change this behavior
you can manipulate <code>index_format</code> variable. I set mine to 30:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set index_format="%4C %Z %{%b %d} %-30.30L (%4l) %s"</span></code></pre></td></tr></table></div></figure>


<h4>Sidebar</h4>

<p>Finally I gave up sidebar for using latest code without annoying <code>tls_socket_read</code> error.
Switching between IMAP folders is not so bad, you can quickly display all
folders by <code>c&lt;Tab&gt;&lt;Tab&gt;</code> or simply <code>y</code></p>

<h4>Offlineimap</h4>

<p>This is probably best program to synchronize your emails with local storage. It
also has feature that allow synchronization between different IMAP servers but
I&rsquo;m not using it. Few things are crucial when using <code>offlineimap</code>:</p>

<ul>
<li>probably easiest way to keep passwords secret is using python hooks for gnome-keyring,
detailed description how to integrate it with <code>offlineimap</code> is
<a href="http://www.clasohm.com/blog/one-entry?entry_id=90957">here</a>. Debian name of
<code>gnome-python2-gnomekeyring</code> is different: <code>python-gnomekeyring</code>.</li>
<li>Use meaningful <code>localfolders</code> because you will use it in <code>mutt</code> configuration</li>
</ul>


<p>Typical configuration of <code>$HOME/.offlineimaprc</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mbnames]
</span><span class='line'>enabled = yes
</span><span class='line'>filename = ~/.mutt/muttrc.mailboxes
</span><span class='line'>header = "mailboxes "
</span><span class='line'>peritem = "+%(accountname)s/%(foldername)s"
</span><span class='line'>sep = " "
</span><span class='line'>footer = "\n"
</span><span class='line'>
</span><span class='line'>[general]
</span><span class='line'>metadata = ~/.offlineimap
</span><span class='line'>maxsyncaccounts = 5
</span><span class='line'>maxconnections = 2
</span><span class='line'>accounts = account1, account2
</span><span class='line'>status_backend = sqlite
</span><span class='line'>pythonfile = ~/.mutt/offlineimap.py
</span><span class='line'>
</span><span class='line'>[Account account1]
</span><span class='line'>autorefresh = 3
</span><span class='line'>localrepository = acc1_local
</span><span class='line'>remoterepository = acc1_remote
</span><span class='line'>
</span><span class='line'>[Repository acc1_local]
</span><span class='line'>type = Maildir
</span><span class='line'>localfolders = ~/.mail/account1
</span><span class='line'>
</span><span class='line'>[Repository acc2_remote]
</span><span class='line'>type = Gmail
</span><span class='line'>remoteusereval = get_username("account1")
</span><span class='line'>remotepasseval = get_password("account1")
</span><span class='line'>sslcacertfile = /etc/ssl/certs/ca-certificates.crt
</span><span class='line'>
</span><span class='line'>[Account account2]
</span><span class='line'>autorefresh = 3
</span><span class='line'>localrepository = acc2_local
</span><span class='line'>remoterepository = acc2_remote
</span><span class='line'>
</span><span class='line'>[Repository acc2_local]
</span><span class='line'>type = Maildir
</span><span class='line'>localfolders = ~/.mail/account2
</span><span class='line'>
</span><span class='line'>[Repository acc2_remote]
</span><span class='line'>type = Gmail
</span><span class='line'>remoteusereval = get_username("account2")
</span><span class='line'>remotepasseval = get_password("account2")
</span><span class='line'>sslcacertfile = /etc/ssl/certs/ca-certificates.crt</span></code></pre></td></tr></table></div></figure>


<p>What this means by section:</p>

<ul>
<li><code>[mbnames]</code> &ndash; automatically create mailboxes folders according to your
configuration on IMAP server</li>
<li><code>[general]</code> &ndash; most important things here are self explanatory accounts
variable and <code>max{syncaccounts,connections}</code>, first said how many accounts
should be synchronized and second how many simultaneous connections should be
used</li>
<li><code>[Account *]</code> &ndash; contain sync refresh time in minutes (<code>autorefresh</code>) and link
to local and remote repository definitions (<code>localrepository</code> and
<code>remoterepository</code>)</li>
<li><code>[Repository *]</code> &ndash; for local folder and its type and for remote gnome-keyring
configuration</li>
</ul>


<h4>Multiple account configuration</h4>

<p>To simplify multiple accounts configuration I added two things:</p>

<ul>
<li>separated account files configuration &ndash; in my case placed in <code>$HOME/.mutt/accounts</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set postponed   = +account1@server.com/Drafts
</span><span class='line'>set spoolfile   = +account1@server.com/INBOX
</span><span class='line'>set record      = +account1@server.com/Sent
</span><span class='line'>set from        = 'account1@server.com'
</span><span class='line'>set realname    = 'My Name'
</span><span class='line'>set smtp_url    = smtps://acc1@smtp.server.com:587
</span><span class='line'>set smtp_pass   = $my_pass
</span><span class='line'>set signature   = "~/.mutt/signature.example"</span></code></pre></td></tr></table></div></figure>


<ul>
<li>folder hooks for particular account &ndash; it cause automatic loading of
configurations when folder was changed (in <code>$HOME/muttrc</code>):</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>folder-hook 'account1@server.com' 'source $HOME/.mutt/accounts/account1'</span></code></pre></td></tr></table></div></figure>


<h4>Separate mailing list file</h4>

<p>I keep my mailing list configuration file separated and source it in my
<code>$HOME/.muttrc</code>. I&rsquo;m not mailing list advanced user, so right now I have manually
created IMAP folders and Gmail filters to move mails from mailing list to this
folders. On the mutt side I use <code>subscribe</code> command to indicate that particular
mail id is a mailing list.</p>

<h3>Personal informations</h3>

<p>Some informations in my configuration files shouldn&rsquo;t be available for all. I
mean my email account configuration, my todo list, passwords and things like
that. To store this informations I use additional private git repository and use
it as a submodule for my workspace configuration. I wrote post about keeping
configuration using git
<a href="/blog/2012/02/19/improve-productivity-by-tracking-work">here</a> and
<a href="/blog/2012/02/20/improve-productivity-by-tracking-work_20">here</a>.</p>

<h3>Taskwarrior and vit</h3>

<p>I really like <code>taskwarrior</code> as a GTD tool but I was tired of writing everything
every time I wanted to change sth. I found <code>vit</code>. Vit is a vi-like interface
to task list generated by <code>taskwarrior</code> it works really great. Mostly it is
written in perl and there is no official repository for its code base but latest
version is from April 2013. I use lot of <code>project:</code> and <code>+flag</code> to update my
TODO list. I prefer <code>long</code> filter.</p>

<h4>My taskwarrior projects and flags</h4>

<p>I have few ongoing projects like <code>blog</code>, <code>productivity</code> and <code>ideas</code>. In addition I use
few flags like <code>ideas</code>, <code>finish</code>, <code>enhancement</code>, <code>fix</code> or <code>bug</code>. So when I
connect project and flag I get few categories like:</p>

<ul>
<li><code>blog ideas</code> for new articles ideas</li>
<li><code>blog finish</code> for articles that should be finished ASAP</li>
<li><code>blog bug/fix</code> for articles that have to be changed for some reason</li>
<li><code>productivity bug/fix</code> for productivity tools configuration improvements</li>
<li><code>productivity ideas</code> for new improvements</li>
</ul>


<h3>Summary</h3>

<p>I think this is enough for first post from this series. Hope it was helpful. If
yes then please share, if no then comment what I should improve. Thanks for
reading.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/15/thunderbird-to-mutt-migration/">Thunderbird to Mutt migration - tips & tricks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-15T18:40:00+02:00" pubdate data-updated="true">May 15<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/15/thunderbird-to-mutt-migration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preface</h3>

<p>I migrate with my working environment to laptop. My workstation going older and
I don&rsquo;t have time to maintain few systems to keep it clean and in sync. I
probably have to improve my work flow but right now I have different problems.
Few weeks ago after changing environment to mobile and powerful laptop I also
changed OS to Ubuntu and mail client to Thunderbird. I have to admit that both
choices were mistake and I want to came back to Debian and Mutt. This post is
about throwing out Thunderbird and a logical continuation of Mutt tutorial (part
<a href="/blog/2012/05/13/mutt-tutorial-part-1-setup-imap-account">1</a>, <a href="/blog/2012/05/13/mutt-tutorial-part-2-secure-login">2</a>,
<a href="/blog/2012/05/13/mutt-tutorial-part-3-sidebar-urls-in-e">3</a> and <a href="/blog/2012/05/13/mutt-tutorial-part-4-html-mails-address">4</a>).</p>

<p>So what was wrong with Thunderbrid ?</p>

<ul>
<li>Not clear configuration settings &ndash; for example I tried to wrap word at 80th
character, default value was set to 72 but it seems not work anyway. I try to
use few googled hints but nothing works.</li>
<li>Setting up Thunderbird to work as a community developer tool was not so
obvious.</li>
<li>Junk messages was marked but default filter show everything so for some IMAP
boxes I get lot of spam and had hard time to find anything out there.</li>
<li>Conversation mode should be easily toggled.</li>
<li>GUI slow switching between different modes.</li>
<li>Lack of my editor of choice.</li>
</ul>


<p>If I decide to use GUI tool for some reason I require from it to be intuitive
and most of my options should be available at few clicks. Probably most of my
problems I could solve by giving enough effort to google it but if I have to
choose hard to configure MUA I will probably be in favor of terminal tool like
Mutt. So right now I&rsquo;m back with Mutt and determination to adjust Mutt to my
work flow.</p>

<h3>Git and undelete old configuration</h3>

<p>I won&rsquo;t go through whole Mutt tutorial once more time. I remember that there was
muttrc in my workspace git repository. So first goolge query returned what
needed I found <a href="http://stackoverflow.com/questions/953481/restore-a-deleted-file-in-a-git-repo">this</a> stackoverflow post.
I reverted muttrc and other related files deletion.</p>

<h3>Short informations</h3>

<ul>
<li>In Ubuntu there is no <code>gpg</code> package, to get encryption you can use <code>gpgsm</code>.</li>
<li>If your e-mail account provider require user name with <code>@</code> (at sign), then you
can pass it in mutt using below pattern:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set folder = imaps://[login]@[imap_server]/ # i.e. imaps://foo@bar.pl@imap.srv.pl/</span></code></pre></td></tr></table></div></figure>


<ul>
<li>You can debug Mutt using <code>-d 5</code> parameter, this option creates
<code>$HOME/.muttdebug0</code> file with verbose output, debug option can be changed in
range 1-5.</li>
<li>Use latest-greatest version compiled from source instead version provided
by distribution repository. It can help you get rid of problems like <code>tls_socket_read (Decryption has failed.)</code>.</li>
<li>Some accounts will not work with authenticating method presented in my
previous post about gpg (<a href="/blog/2012/05/13/mutt-tutorial-part-2-secure-login">mutt tutorial part 2</a>).
To workaround this you can use different format of folder variable:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set folder = imaps://[login]:[passwd_var]@[imap_server]/ # i.e. imaps://foo:$my_bar_passwd@bar.pl@imap.srv.pl/</span></code></pre></td></tr></table></div></figure>


<h3>Compile Mutt from source</h3>

<p>If you looking for latest Mutt version consider compiling mutt by yourself.
First, download sources:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hg clone http://dev.mutt.org/hg/mutt#HEAD
</span><span class='line'>hg update -C HEAD
</span><span class='line'>hg pull -u</span></code></pre></td></tr></table></div></figure>


<p>There are lot of options to prepare Mutt compilation, but right now I can
suggest this parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd mutt
</span><span class='line'>./prepare --with-ssl --enable-debug --enable-imap --enable-smtp --enable-pop \
</span><span class='line'>-enable-hcache --with-gss --with-gnutls --with-sasl
</span><span class='line'>make && sudo make install</span></code></pre></td></tr></table></div></figure>


<p>If make will complain about <code>gssapi/gssapi.h: No such file or directory</code> then
you need to install <code>libkrb5-dev</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install libkrb5-dev</span></code></pre></td></tr></table></div></figure>


<h3>Summary</h3>

<p>That&rsquo;s all in this post but I&rsquo;m sure that there will be next in this topic. I
hope to improve my whole workflow and write few posts about improving
productivity using open source tools.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/12/kernel-developers-tools/">Kernel developers tools - based on &#8216;30 Linux Kernel Developers in 30 Weeks&#8217;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-12T02:41:00+02:00" pubdate data-updated="true">May 12<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/12/kernel-developers-tools/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>git, cscope, vi, bash, awk, and the rare bout with python.
Ubuntu with Unity2D
terminal, make, gcc, make me happy. Quilt for patch management, Git or
Subversion for source code management. I&rsquo;m using Nedit
SLED for work and openSUSE
email client (mutt), and my editor (vim),
git and quilt for kernel development, Chrome and Firefox for web browsing, and
irssi for irc communication
NOME 3 on my desktop, but sometimes get frustrated with it and revert back to
OpenBox or i3m
Xfce
fbcon, vim, and mutt
fvwm2
bash shell, joe editor, gcc, make, git
 Fedora
 Xfce
 git, sparse, smatch and spatch
 joe
  xterm, emacs, perl, mc and git.
  i3
  Emacs, ocaml, xfce
  Emacs, Evolution, GNOME 3, Iceweasel (aka Firefox)
  git, gcc, gmake, bash, perl
  Thunderbird</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'pietrushnics-world';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
  $(document).ready(function() {
    $(".fancybox").fancybox();
  });
</script>


</body>
</html>
